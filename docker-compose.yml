services:
  wgrest:
    image: ghcr.io/suquant/wgrest:latest
    container_name: wgrest
    restart: unless-stopped
    network_mode: host
    privileged: true
    depends_on:
      - wireguard
    volumes:
      - /etc/wireguard:/etc/wireguard
      - ./config/wgrest.toml:/etc/wgrest/config.toml:ro
    environment:
      - WG_DEVICE=wg0,wg1
      - WGREST_LISTEN=127.0.0.1:8080
      - WGREST_AUTH_TOKEN=${WGREST_API_KEY}

  wireguard:
    image: lscr.io/linuxserver/wireguard:latest
    container_name: wireguard
    restart: unless-stopped
    network_mode: host
    privileged: true
    cap_add:
      - NET_ADMIN
      - SYS_MODULE
    volumes:
      - /lib/modules:/lib/modules:ro
    command: /bin/sh -c "modprobe wireguard && sleep infinity"